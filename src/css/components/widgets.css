/* ==========================================================================
   WIDGETS COMPONENT
   ========================================================================== */

/* --- CORE LAYOUT --- */

.widgets-section {
    margin-top: 32px;
    margin-bottom: 80px;
}

.widgets-header {
    display: flex;
    align-items: center;
    gap: 12px;
}

.widgets-description {
    margin-bottom: 32px;
    color: var(--md-sys-color-on-surface-variant);
}

.widgets-grid {
    display: grid;
    /* Strict 100px columns */
    grid-template-columns: repeat(auto-fill, 100px);
    grid-auto-rows: 100px;
    grid-auto-flow: dense; /* Help fill gaps */
    gap: 0; /* Remove gap so cells touch grid lines */
    justify-content: start; /* Start grid from left */
    padding: 0; /* Remove inner padding so grid starts at edge */
    width: 100%;
    margin: 0 auto;
}

.widgets-header-container {
    border-bottom: 1px solid var(--md-sys-color-outline-variant);
    padding-bottom: 40px;
    margin-bottom: 48px;
}

.widgets-content-container {
    margin: 0 auto;
    width: 100%;
    /* Strict width to ensure perfect 100px alignment */
    /* width is set by JS now */
    max-width: 100%;
    
    padding: 0; /* Remove padding to maximize grid area */
    
    background-image: none;
    background-color: var(--md-sys-color-surface);
    
    border: 1px solid var(--md-sys-color-outline-variant);
    border-radius: var(--md-sys-shape-corner-extra-large); 
    box-sizing: border-box;
    transition: width 0.4s cubic-bezier(0.2, 0, 0, 1);
    overflow: hidden; 
    position: relative;
    min-height: 800px;
}

/* THE VISUAL GRID BACKGROUND */
.widgets-content-container.grid-active {
    background-image: 
        linear-gradient(var(--md-sys-color-outline-variant) 1px, transparent 1px),
        linear-gradient(90deg, var(--md-sys-color-outline-variant) 1px, transparent 1px);
    background-size: 100px 100px; /* Force 100px strict */
    background-position: 0 0;
}


/* MOBILE REFINEMENTS (Dynamic Grid naturally scale) */
@media (max-width: 720px) {
    .widgets-content-container {
        border-radius: 16px;
    }
    
    .widgets-header-container {
        display: flex;
        flex-direction: column !important;
        align-items: flex-start !important;
        gap: 24px !important;
    }

    .grid-toggle-wrapper {
        width: 100%;
        justify-content: space-between;
    }

}

.widgets-content-container.grid-active {
    background-image: 
        linear-gradient(var(--md-sys-color-outline-variant) 1px, transparent 1px),
        linear-gradient(90deg, var(--md-sys-color-outline-variant) 1px, transparent 1px);
}

/* Desktop Snapping handled by JS for perfect 100px precision */
@media (min-width: 721px) {
    /* Base styles or specific overrides if needed */
}

.widget-wrapper {
    display: flex;
    flex-direction: column;
    padding: 0; /* Remove padding from wrapper to align header strictly */
    box-sizing: border-box;
    width: 100%;
    height: 100%;
}

/* Strict Grid Positioning */
.w-5x4 { grid-column: span 5; grid-row: span 4; }
.w-5x3 { grid-column: span 5; grid-row: span 3; }
.w-5x2 { grid-column: span 5; grid-row: span 2; }
.w-5x1 { grid-column: span 5; grid-row: span 1; }

.w-4x5 { grid-column: span 4; grid-row: span 5; } /* New for 4x4 + label */
.w-4x4 { grid-column: span 4; grid-row: span 4; }
.w-4x3 { grid-column: span 4; grid-row: span 3; }
.w-4x2 { grid-column: span 4; grid-row: span 2; }
.w-4x1 { grid-column: span 4; grid-row: span 1; }

.w-3x4 { grid-column: span 3; grid-row: span 4; } /* New for 3x3 + label */
.w-3x3 { grid-column: span 3; grid-row: span 3; }
.w-3x2 { grid-column: span 3; grid-row: span 2; }
.w-3x1 { grid-column: span 3; grid-row: span 1; }

/* Grid classes are now handled by JS auto-placement based on w-NxM conventions */

.widget-wrapper {
    display: flex;
    flex-direction: column;
    padding: 0; /* No padding between widget edge and cell edge */
    box-sizing: border-box;
    width: 100%;
    height: 100%;
}

/* Default: Labels are visible */
.widget-wrapper > h3 {
    margin: 0;
    font-size: 14px;
    font-weight: 500;
    color: var(--md-sys-color-on-surface-variant);
    
    /* Strict Label Row: 100px height */
    height: 100px;
    flex-shrink: 0;
    display: flex; 
    align-items: center; 
    padding-left: 16px; 
    box-sizing: border-box;
    align-items: flex-end;
    padding-bottom: 24px;
    transition: height 0.3s cubic-bezier(0.2, 0, 0, 1), opacity 0.2s;
}

/* Hidden state */
.widgets-grid.labels-hidden .widget-wrapper > h3 {
    height: 0;
    opacity: 0;
    padding: 0;
    overflow: hidden;
}

.grid-label {
    margin-left: 8px;
    opacity: 0.6;
    font-weight: 400;
    font-size: 12px;
}

.widget-wrapper .md-card {
    margin: 2px; /* 2px spacing on all sides */
    width: auto; /* Allow margin to determine width */
    flex: 1; /* Fill remaining space naturally */
    height: auto;
    max-width: none !important;
    max-height: none !important;
    overflow: hidden; /* Prevent content overflow leaking from cards */
}

/* Global Reset for all headings and paragraphs inside a widget to avoid style leakage from base.css */
.widget-wrapper .md-card h1,
.widget-wrapper .md-card h2,
.widget-wrapper .md-card h3,
.widget-wrapper .md-card h4,
.widget-wrapper .md-card h5,
.widget-wrapper .md-card h6,
.widget-wrapper .md-card p {
    margin: 0 !important;
    padding: 0 !important;
    box-sizing: border-box;
}

/* --- BASE STYLES --- */

.card-media-placeholder {
    height: 180px;
    background-color: var(--md-sys-color-surface-container-highest);
    border-radius: 12px;
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--md-sys-color-on-surface-variant);
    font-size: 48px;
}


/* ==========================================================================
   INVIDIDUAL WIDGET STYLES
   ========================================================================== */

/* --- 1. Music Player (Card) --- */
#widget-music-card .card-music-widget {
    display: flex; 
    flex-direction: row; 
    align-items: center; 
    padding: 0 !important;
    overflow: hidden; 
    border-radius: var(--md-sys-shape-corner-extra-large);
    background: var(--md-sys-color-surface-container-low);
    color: var(--md-sys-color-on-surface);
    height: 100% !important;
    box-sizing: border-box;
}

#widget-music-card .card-media {
    width: 96px; 
    height: 100%; 
    aspect-ratio: 1/1;
    margin: 0; 
    border-radius: 0; 
    flex-shrink: 0;
    display: flex; 
    align-items: center; 
    justify-content: center;
    background: var(--md-sys-color-surface-container-high);
    color: var(--md-sys-color-primary);
}

#widget-music-card .card-media span { 
    font-size: 40px; 
}

#widget-music-card .card-content { 
    padding: 0 20px; 
    flex: 1; 
    min-width: 0; 
    display: flex;
    flex-direction: column;
    justify-content: center;
    height: 100%;
    overflow: hidden;
}

#widget-music-card .widget-controls { 
    display: flex; 
    align-items: center; 
    gap: 8px; 
    padding: 0 16px; 
}

#widget-music-card .widget-controls .play-btn {
    background: var(--md-sys-color-primary-container);
    color: var(--md-sys-color-on-primary-container);
    width: 40px; height: 40px;
    border-radius: 50%;
}

#widget-music-card .card-content h3 { 
    margin: 0; 
    padding: 0;
    font-size: 16px; 
    line-height: 1.2; 
    white-space: nowrap; 
    overflow: hidden; 
    text-overflow: ellipsis; 
}

#widget-music-card .card-content p { 
    margin: 0; 
    padding: 0;
    font-size: 13px; 
    line-height: 1.2; 
    color: var(--md-sys-color-on-surface-variant); 
    white-space: nowrap; 
    overflow: hidden; 
    text-overflow: ellipsis; 
}


/* --- 2. Music Player (Daily Mix) --- */
#widget-daily-mix .daily-mix-media {
    background: #D7E3FF; /* Light blue from image */
    height: 35%; /* Top section */
    margin: 0;
    border-radius: 0;
    display: flex; 
    align-items: center; 
    justify-content: center;
    color: #001D35; /* Dark navy icon */
}

#widget-daily-mix .daily-mix-media span {
     font-size: 64px;
}

#widget-daily-mix .card-daily-mix {
    padding: 0; 
    overflow: hidden; 
    background: #E2E2E2; /* Light grey/beige from image */
    border-radius: 28px;
    display: flex;
    flex-direction: column;
}

#widget-daily-mix .daily-mix-content {
    padding: 24px;
    flex: 1;
    display: flex;
    flex-direction: column;
}

#widget-daily-mix .daily-mix-title {
    font-size: 28px; 
    margin-bottom: 4px;
    color: #191C1E;
    font-weight: 400;
}

#widget-daily-mix .daily-mix-subtitle {
     color: #444749; 
     margin-bottom: 24px; 
     font-size: 14px;
}

#widget-daily-mix .daily-mix-list {
    background: #FFFFFF !important;
    border-radius: 24px; 
    padding: 8px; 
    margin-top: auto; /* Push to bottom if space */
    box-shadow: 0 4px 8px rgba(0,0,0,0.05);
}

[data-theme="dark"] #widget-daily-mix .daily-mix-list {
    background: #2C2C2C !important;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

#widget-daily-mix .daily-mix-list .list-item { 
    padding: 16px !important; 
    border-radius: 16px;
    margin: 0;
    display: flex;
    align-items: center;
    border-bottom: 1px solid #F0F0F0;
}

[data-theme="dark"] #widget-daily-mix .daily-mix-list .list-item {
     border-bottom: 1px solid #3C3C3C;
}

#widget-daily-mix .daily-mix-list .list-item:last-child {
    border-bottom: none;
}

#widget-daily-mix .daily-mix-list .list-item:hover {
    background-color: rgba(0,0,0,0.03);
}

[data-theme="dark"] #widget-daily-mix .daily-mix-list .list-item:hover {
    background-color: rgba(255,255,255,0.05);
}

#widget-daily-mix .daily-mix-item-content {
    margin-left: 16px;
}

#widget-daily-mix .daily-mix-item-title {
    font-weight: 500; 
    font-size: 16px;
    color: #191C1E;
}

[data-theme="dark"] #widget-daily-mix .daily-mix-item-title {
    color: #E2E2E2;
}

#widget-daily-mix .daily-mix-item-artist {
    font-size: 12px;
    color: #444749;
    margin-top: 2px;
}

[data-theme="dark"] #widget-daily-mix .daily-mix-item-artist {
    color: #C4C7C9;
}


/* --- 3. Music Player (Circular) --- */
#widget-circular-music .widget-circular-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 16px;
    height: 100%;
}

#widget-circular-music .card-music-circular {
    width: 100%; 
    height: 100%;
    position: relative; 
    margin: 0; 
    background: transparent; 
    border: none; 
    cursor: default;
    display: flex;
    align-items: center; 
    justify-content: center;
}

#widget-circular-music .music-circle-container {
    position: relative;
    width: 240px; 
    height: 240px;
    display: flex;
    align-items: center;
    justify-content: center;
    /* Calculated for 45deg on circle: 1 - sin(45) * 0.5 = ~14.64% from edge */
}

#widget-circular-music .album-art { 
    width: 100%; 
    height: 100%; 
    border-radius: 50%;
    overflow: hidden; 
    background: var(--md-sys-color-secondary-container);
    display: flex; 
    align-items: center; 
    justify-content: center;
    box-shadow: var(--md-sys-elevation-3);
    position: relative; 
    z-index: 1;
}

#widget-circular-music .album-art span { 
    font-size: 80px; 
    color: var(--md-sys-color-primary); 
    opacity: 0.5; 
}

#widget-circular-music .float-btn {
    position: absolute; 
    display: flex; 
    align-items: center; 
    justify-content: center;
    border: none; 
    cursor: pointer; 
    z-index: 5;
    box-shadow: var(--md-sys-elevation-2);
    transition: 0.2s cubic-bezier(0.2, 0, 0, 1);
}

#widget-circular-music .float-btn:hover { 
    box-shadow: var(--md-sys-elevation-3); 
}



#widget-circular-music .play-pause {
    width: 80px; 
    height: 80px;
    background: var(--md-sys-color-primary-container);
    color: var(--md-sys-color-on-primary-container);
    border-radius: 24px; 
    bottom: 14.65%; 
    left: 14.65%;
    transform: translate(-50%, 50%); /* Center on the border point */
}

#widget-circular-music .play-pause:hover {
    transform: translate(-50%, 50%) scale(1.1);
}

#widget-circular-music .play-pause:active {
    transform: translate(-50%, 50%) scale(0.95);
}

#widget-circular-music .play-pause span { 
    font-size: 36px; 
}

#widget-circular-music .repeat-btn {
    width: 56px; 
    height: 56px;
    background: var(--md-sys-color-tertiary-container);
    color: var(--md-sys-color-on-tertiary-container);
    border-radius: 50%;
    top: 14.65%; 
    right: 14.65%;
    transform: translate(50%, -50%); /* Center on the border point */
}

#widget-circular-music .repeat-btn:hover {
    transform: translate(50%, -50%) scale(1.1);
}

#widget-circular-music .repeat-btn:active {
    transform: translate(50%, -50%) scale(0.95);
}

#widget-circular-music .repeat-btn span { 
    font-size: 24px; 
}


/* --- 4. Music Player (Compact) --- */
#widget-compact-music .card-music-compact {
    display: flex; 
    flex-direction: row; 
    align-items: center; 
    padding: 12px 16px !important;
    min-height: 88px; 
    border-radius: 24px;
    background: var(--md-sys-color-surface-container);
    color: var(--md-sys-color-on-surface);
    box-shadow: none;
}

#widget-compact-music .card-media {
    width: 64px; 
    height: 64px; 
    border-radius: 16px;
    background: var(--md-sys-color-secondary-container);
    color: var(--md-sys-color-on-secondary-container);
    display: flex; 
    align-items: center; 
    justify-content: center;
    flex-shrink: 0;
}

#widget-compact-music .card-media span { 
    font-size: 32px; 
    line-height: 0; 
    display: flex; 
    align-items: center; 
    justify-content: center;
}

#widget-compact-music .card-content { 
    flex: 1; 
    padding: 0 16px; 
    min-width: 0; 
    display: flex; 
    flex-direction: column; 
    justify-content: center; 
}

#widget-compact-music .card-content h3 { 
    font-size: 18px; 
    margin: 0; 
    line-height: 1.1; 
    font-weight: 600; 
}

#widget-compact-music .card-content p { 
    font-size: 14px; 
    margin: 4px 0 0 0; 
    line-height: 1.1; 
    color: var(--md-sys-color-on-surface-variant); 
}

#widget-compact-music .icon-btn { 
    flex-shrink: 0; 
}


/* --- 5. Digital Clock --- */
#widget-clock .widget-clock-card {
    padding: 8px; 
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: var(--md-sys-color-primary-container);
    color: var(--md-sys-color-on-primary-container);
}

#widget-clock .widget-clock-time {
    font-size: 32px;
    font-weight: 700;
    line-height: 1.1;
}

#widget-clock .widget-clock-date {
    font-size: 16px;
    opacity: 0.8;
    margin-top: 4px;
}


/* --- 6. Weather --- */
#widget-weather .widget-weather-card {
    padding: 8px;
    background: linear-gradient(135deg, var(--md-sys-color-tertiary-container), var(--md-sys-color-primary-container));
    display: flex;
    flex-direction: column;
    justify-content: center;
}

#widget-weather .widget-weather-city {
    font-size: 18px;
    font-weight: 500;
}

#widget-weather .widget-weather-temp {
    font-size: 40px;
    font-weight: 700;
    margin: 2px 0;
    line-height: 1.1;
}

#widget-weather .widget-weather-condition {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 16px;
}


/* --- 7. Stopwatch --- */
#widget-stopwatch .widget-row-card {
    padding: 0 16px;
    display: flex;
    align-items: center;
    gap: 12px;
}

#widget-stopwatch .widget-stopwatch-time {
    font-size: 24px;
    font-weight: 700;
    flex: 1;
}


/* --- 8. Battery --- */
#widget-battery .widget-row-card {
    padding: 0 16px;
    display: flex;
    align-items: center;
    gap: 12px;
}

#widget-battery .widget-battery-icon {
    color: var(--md-sys-color-success);
}

#widget-battery .widget-battery-text {
    font-size: 20px;
    font-weight: 700;
}

#widget-battery .widget-battery-bar-container {
    flex: 1;
    height: 12px;
    background: var(--md-sys-color-surface-container);
    border-radius: 6px;
    overflow: hidden;
}

#widget-battery .widget-battery-bar-fill {
    width: 85%;
    height: 100%;
    background: var(--md-sys-color-success);
}


/* --- 9. News Widget --- */
#widget-news .widget-news-card {
    padding: 0;
    display: flex;
    flex-direction: row;
    overflow: hidden;
}

#widget-news .widget-news-media {
    width: 40%;
    background: var(--md-sys-color-surface-container-highest);
    display: flex;
    align-items: center;
    justify-content: center;
}

#widget-news .widget-news-media span {
    font-size: 64px;
}

#widget-news .widget-news-content {
    flex: 1;
    padding: 4px 12px;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

#widget-news .widget-news-tag {
    color: var(--md-sys-color-primary);
    font-weight: 700;
    text-transform: uppercase;
    font-size: 12px;
    letter-spacing: 1px;
}

#widget-news .widget-news-title {
    font-size: 18px;
    margin: 4px 0;
    line-height: 1.2;
}

#widget-news .widget-news-summary {
    color: var(--md-sys-color-on-surface-variant);
    margin-bottom: 8px;
    font-size: 13px;
}

#widget-news .widget-news-btn {
    width: fit-content;
}


/* --- 10. Calendar Widget --- */
#widget-calendar .widget-calendar-card {
    padding: 24px;
}

#widget-calendar .widget-calendar-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 16px;
}

#widget-calendar .widget-calendar-header h3 {
    margin: 0;
}

#widget-calendar .widget-calendar-event {
    display: flex;
    gap: 12px;
    align-items: center;
    padding: 12px;
    border-radius: 12px;
    background: var(--md-sys-color-surface-container-high);
    margin-bottom: 8px;
}

#widget-calendar .widget-calendar-event:last-child {
    margin-bottom: 0;
}

#widget-calendar .widget-calendar-time {
    font-weight: 700;
    color: var(--md-sys-color-primary);
}


/* --- 11. Recent Contacts --- */
#widget-contacts .widget-contacts-card {
    margin: 0;
    padding: 0;
}

#widget-contacts .widget-contacts-list {
    background: transparent;
}

#widget-contacts .avatar-a { background: var(--md-sys-color-primary-container); color: var(--md-sys-color-on-primary-container); }
#widget-contacts .avatar-b { background: var(--md-sys-color-secondary-container); color: var(--md-sys-color-on-secondary-container); }
#widget-contacts .avatar-c { background: var(--md-sys-color-tertiary-container); color: var(--md-sys-color-on-tertiary-container); }

#widget-contacts .contact-info {
    flex: 1;
}

#widget-contacts .contact-name {
    font-weight: 600;
}

#widget-contacts .contact-meta {
    font-size: 13px;
    color: var(--md-sys-color-on-surface-variant);
}
